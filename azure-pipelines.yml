# Run generate-docs script.

trigger:
- master

# Specifying nothing is the same as this for PRs:
# pr:
# - *

# use the self-hosted runner at tristano.neuro.polymtl.ca
# this has Matlab installed and a license to use it.
pool: 'Default'

steps:
# Build condition : IndividualCI is a trigger (trigger only happens on master merge/push)
# If there is a push on a PR, it wont do this step.
- script: |
    chmod 755 generate-docs.sh
    ./generate-docs.sh
  displayName: 'Generate and publish website'
  condition: and(succeeded(),ne(variables['Build.Reason'],'IndividualCI'))
  env:
    GH_PAGES_TOKEN: $(GH_PAGES_TOKEN)
    CUSTOM_DOMAIN: www.shimming-toolbox.org
# Always do this step
- script: |
    # Beware: you MUST put `quit` at the end; Matlab does not auto-quit.
    # And worse, our Matlab license only allows one process at a time (TODO: verify this),
    # so a forgotten `quit` will block all tests on all branches.
    # https://www.mathworks.com/matlabcentral/answers/523194-matlab-script-in-batch-from-unix-command-line
    matlab -nodisplay -nosplash -r "disp('Unit tests!'); quit"
  displayName: 'Unit Tests'
